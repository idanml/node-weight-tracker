pipeline {
    agent {label 'SlaveVm1'}
    stages {
		stage('ansible maintain') {
			steps {
                sh 'ansible-playbook ./ansible/maintain.yml'
			}
        }
		stage('npm install') {
			steps {
                sh 'npm install'
			}
        }		
		stage('create tar.gz') {
			steps {
				sh 'touch artifact.tar.gz'
				sh 'tar --exclude=artifact.tar.gz --exclude=ansible -zcvf artifact.tar.gz -C /home/idanml/jenkins/workspace/CI .'
			}
		}
    }
	post {
		success {
			azureUpload containerName: 'jenkins', filesPath: 'artifact.tar.gz', storageCredentialId: '4dd867c1-7a71-4665-a7f9-a56faa562d6a', storageType: 'blobstorage'
		}
		failure {
            sh 'echo "CI pipline has been failed "'
        }
	}	
}